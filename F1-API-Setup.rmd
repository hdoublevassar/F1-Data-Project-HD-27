---
title: "F1-API-Setup"
output: 
  html_document:
    code_folding: show
    theme:
      bg: "#202123"
      fg: "#B8BCC2"
      primary: "#EA80FC"
      base_font:
        google: Prompt
      heading_font:
        google: Proza Libre
      version: 3
---


```{r Libraries}
library(tidyverse)
library(ggplot2)
library(jsonlite)
library(httr)
```

#Using the OpenF1 API, this chunk aims to retreive data on F1 sessions, which will be filtered and used to iscolate perfomrance data.
```{r Sessions-API}
# Get all drivers for the session
#url <- "https://api.openf1.org/v1/drivers?session_key=9158" # nolint: commented_code_linter.

# For sessions:
url_sessions <- "https://api.openf1.org/v1/sessions"
# For meetings: url_meetings <- "https://api.openf1.org/v1/meetings"
# For positions: url_positions <- "https://api.openf1.org/v1/position?session_key=9158"
# For lap times: url_laps <- "https://api.openf1.org/v1/laps?session_key=9158"
# For car data: url_car_data <- "https://api.openf1.org/v1/car_data?session_key=9158"

resp <- httr::GET(url_sessions)
if (resp$status_code != 200) {
  stop("Request failed: ", resp$status_code, " â€” ", httr::content(resp, "text"))
}

text <- httr::content(resp, "text", encoding = "UTF-8")
session_data <- jsonlite::fromJSON(text, simplifyVector = TRUE)
print(session_data)
```

#Filtering down to just Race Sessions in the Year 2025
```{r Filter-Sessions}
##I am creating a new dataframe that filters the session_data dataframe, isolating just the session type and the year
race_sessions_2025 <- dplyr::filter(session_data, session_name == "Race", year == 2025) 
```

#Races per Country
```{r Races-By-Country}
# Bar chart showing which countries host the most races
race_sessions_2025 %>%
  count(country_name, sort = TRUE) %>%
  ggplot(aes(x = reorder(country_name, n), y = n, fill = country_name)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = n), hjust = -0.3, size = 4) +
  coord_flip() +
  scale_fill_viridis_d(option = "plasma") +
  labs(
    title = "Number of F1 Races per Country in 2025",
    x = "Country",
    y = "Number of Races"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    axis.text.y = element_text(size = 11)
  ) +
  ylim(0, max(table(race_sessions_2025$country_name)) + 0.5)
```

#Race Distribution by Month
```{r Races-By-Month}
# Show how races are distributed across months
race_sessions_2025 %>%
  mutate(
    month = lubridate::month(as.Date(date_start), label = TRUE, abbr = FALSE)
  ) %>%
  count(month) %>%
  ggplot(aes(x = month, y = n, fill = n)) +
  geom_col() +
  geom_text(aes(label = n), vjust = -0.5, size = 5, fontface = "bold") +
  scale_fill_gradient(low = "#440154", high = "#FDE725") +
  labs(
    title = "F1 Race Distribution by Month (2025)",
    subtitle = "When are races most concentrated during the season?",
    x = "Month",
    y = "Number of Races"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    panel.grid.major.x = element_blank()
  )
```
