---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
# Refined Cleaning Methods
```{r API-Setup, include=FALSE}
source("F1-API-Setup.r")
knitr::opts_chunk$set(error=FALSE)
```

## Session Iscolation
```{r Session-Iscolation}
race_sessions <- dplyr::filter(session_data, session_name == "Race")
race_sessions <- race_sessions[!duplicated(race_sessions$session_key),] #Just  procoutionary, in the current state, this does nothing
```

## Driver Data Cleanup
Cleaning up the driver data into a usable state prior to use
### Fixing Color Codes
```{r Color-Codes-Fixed}
driver_names$team_colour <- paste0("#", driver_names$team_colour)
```

### Filtering to Race Drivers Only
```{r Driver-Data}
race_drivers_all <- dplyr::filter(driver_names, session_key %in% race_sessions$session_key)
```

### Adding Driver Info
```{r Reduction-Driver-Columns}
limited_drivers <- race_drivers_all %>%
  select(-meeting_key, -broadcast_name, -first_name, -last_name)
```
## Pitstop Data Cleaning
In this section I am cleaning the pitstop_data$pit_duration to remove na values, and outliers.
### Filtering Down to Race Pitstops
```{r Race-Pitstops}
pitstop_data <- pitstop_data %>% 
  filter(session_key %in% race_sessions$session_key)
```
### Joining Driver Information
```{r Joining}
pitstop_data <- pitstop_data %>%
  left_join(limited_drivers, by = c("session_key", "driver_number")) %>%
  filter(!is.na(pit_duration))
```
### Outlier Determination
- Data is tracked from the start of the pitlane to the end, regardless of condition. Under a safety car, all cars are pitted for long periods of time, same is true for a DNF.
- Due to this, I intend to remove all pitstops which exceed 150 seconds first, after which point I will remove the outliers of the remaining set.
- Possible confounding variables: both drive-through and stop-and-go penalties are potentially problematic and will artifically inflate/deflate certain drivers stats.
- I have not yet confirmed that the drive-through/stop-and-go penalties are being tracked, but 12 seconds is far too short an amount of time in the pitlane. 
```{r Outliers}
summary(pitstop_data$pit_duration)
pitstop_data <- pitstop_data[pitstop_data$pit_duration <= 150,]
pitstop_duration_Q1 <- quantile(pitstop_data$pit_duration, 0.25, na.rm = TRUE)
pitstop_duration_Q3 <- quantile(pitstop_data$pit_duration, 0.75, na.rm = TRUE)
pitstop_iqr <- pitstop_duration_Q3 - pitstop_duration_Q1 #I could also just do this with pitstop_iqr <- IQR(pitstop_data$pit_duration, na.rm = TRUE)
pitstop_median <- median(pitstop_data$pit_duration, na.rm = TRUE)
summary(pitstop_data$pit_duration)
```

### Cleanup
```{r Removing-Na-Values}
pitstop_data <- pitstop_data %>%
  drop_na(pit_duration)
```
